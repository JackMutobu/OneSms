@page "/ussdtestadmin"
@inherits ReactiveComponentBase<UssdTestAdminViewModel>
@attribute [Authorize(Roles = "SuperAdmin")]
    <PageHeader BackIcon="string.Empty">
        <PageHeaderTitle>Ussd Test</PageHeaderTitle>
        <PageHeaderExtra>
            <Text>CurrentServerKey: @ViewModel.CurrentServerKey</Text>
            <Select DefaultValue=@(ViewModel.CurrentServerKey) Style="width:100px" OnChange="OnServerChange">
                @foreach (var item in ViewModel.MobileServers)
                {
                    <SelectOption Value="@item.Id.ToString()">@item.Name</SelectOption>
                }
            </Select>
            <Button Type="danger" @onclick="() => CancelUssdOperation(ViewModel?.CurrentServerKey)">Cancel</Button>
        </PageHeaderExtra>
    </PageHeader>
<Text Type="danger">@ViewModel.Errors</Text>

<Form Layout="@FormLayout.Horizontal"
      Model="@ussdTransaction"
      OnFinish="OnFinish">
    <FormItem Label="Sim">
        <Select Size="@InputSize.Large" Placeholder="Select Sim" OnChange="OnSimSelectChange">
            @foreach (var sim in ViewModel.SimCards)
            {
                <SelectOption Value="@sim.Id.ToString()">@($"{sim.Name} - {sim?.MobileServer?.Name}")</SelectOption>
            }
        </Select>
    </FormItem>

    <FormItem Label="Action">
        <Select Size="@InputSize.Large" Placeholder="Select Action" OnChange="OnUssdActionSelectChange">
            @foreach (var item in ViewModel.UssdActions)
            {
                <SelectOption Value="@item.Id.ToString()">@item</SelectOption>
            }
        </Select>
    </FormItem>

    <FormItem>
        <Button Type="@ButtonType.Primary" Size="@InputSize.Large" HtmlType="submit">
            Submit
        </Button>
    </FormItem>
</Form>

<Table DataSource="@ViewModel.UssdTransactions" Class="table-responsive">
    <Column @bind-Field="@context.SimId"></Column>
    <Column @bind-Field="@context.UssdAction?.ActionType"></Column>
    <ActionColumn Title="Sim">@context.Sim?.Number</ActionColumn>
    <ActionColumn Title="Sim Name">@context.Sim?.Name</ActionColumn>
    <Column @bind-Field="@context.TransactionState"></Column>
    <Column @bind-Field="@context.TransactionId"></Column>
    <Column @bind-Field="@context.StartTime"></Column>
    <Column @bind-Field="@context.EndTime"></Column>
    <ActionColumn Title="Time">
        @((context.EndTime - context.StartTime).TotalSeconds) seconds
    </ActionColumn>
</Table>